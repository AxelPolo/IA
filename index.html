<html><head><base href="https://claude.ai/chat">
<title>PoloGPT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root {
  --bg-color: #121212;
  --text-color: #e0e0e0;
  --chat-bg: #1e1e1e;
  --user-msg-bg: #2c3e50;
  --ai-msg-bg: #34495e;
  --system-msg-bg: #7f8c8d;
  --input-bg: #2c3e50;
  --button-bg: #3498db;
  --button-hover: #2980b9;
  --code-bg: #2d2d2d;
}

.light-theme {
  --bg-color: #f5f7fa;
  --text-color: #333333;
  --chat-bg: #ffffff;
  --user-msg-bg: #e1f5fe;
  --ai-msg-bg: #f0f4c3;
  --system-msg-bg: #e8eaf6;
  --input-bg: #ffffff;
  --button-bg: #4caf50;
  --button-hover: #45a049;
  --code-bg: #f5f5f5;
}

body {
  font-family: 'Roboto', sans-serif;
  margin: 0;
  padding: 0;
  background-color: var(--bg-color);
  color: var(--text-color);
  transition: all 0.3s ease;
  font-size: 14px;
}

.app-container {
  max-width: 100%;
  margin: 0 auto;
  padding: 10px;
}

.header {
  text-align: center;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header h1 {
  font-size: 1.5em;
  margin: 0;
  font-weight: 700;
  color: #3498db;
}

.chat-container {
  background-color: var(--chat-bg);
  border-radius: 8px;
  padding: 10px;
  height: calc(100vh - 150px);
  overflow-y: auto;
  margin-bottom: 10px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.message {
  margin-bottom: 8px;
  padding: 10px;
  border-radius: 8px;
  font-size: 0.95em;
}

.user { 
  background-color: var(--user-msg-bg); 
  text-align: right; 
  margin-left: 20%;
}

.ai { 
  background-color: var(--ai-msg-bg);
  margin-right: 20%;
}

.system { 
  background-color: var(--system-msg-bg); 
  font-style: italic; 
  text-align: center;
  margin: 10px 10%;
}

.copy-button {
  background-color: var(--button-bg);
  color: white;
  border: none;
  border-radius: 4px;
  padding: 5px 10px;
  font-size: 0.8em;
  cursor: pointer;
  margin-top: 5px;
  transition: background-color 0.3s ease;
}

.copy-button:hover {
  background-color: var(--button-hover);
}

.input-area {
  display: flex;
  flex-direction: column;
}

.input-container {
  display: flex;
  margin-bottom: 5px;
}

#user-input {
  flex-grow: 1;
  padding: 12px;
  border: none;
  border-radius: 4px;
  background-color: var(--input-bg);
  color: var(--text-color);
  font-size: 0.95em;
}

#send-button {
  padding: 10px 20px;
  background-color: var(--button-bg);
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  margin-left: 10px;
  transition: all 0.3s ease;
  font-size: 1em;
  font-weight: bold;
}

#send-button:hover {
  background-color: var(--button-hover);
}

.menu {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 10px;
}

#language-select, #theme-switch {
  padding: 6px 12px;
  border-radius: 4px;
  background-color: var(--input-bg);
  color: var(--text-color);
  border: none;
  margin-left: 10px;
  font-size: 0.9em;
  cursor: pointer;
  transition: all 0.3s ease;
}

#language-select:hover, #theme-switch:hover {
  opacity: 0.8;
}

.code-block {
  background-color: var(--code-bg);
  border-radius: 4px;
  padding: 10px;
  margin-top: 10px;
  margin-bottom: 10px;
  white-space: pre-wrap;
  font-family: 'Courier New', Courier, monospace;
}

.code-copy-button {
  background-color: var(--button-bg);
  color: white;
  border: none;
  border-radius: 4px;
  padding: 5px 10px;
  font-size: 0.8em;
  cursor: pointer;
  margin-top: 5px;
  transition: background-color 0.3s ease;
  display: block;
}

.code-copy-button:hover {
  background-color: var(--button-hover);
}

@media (max-width: 600px) {
  .menu {
    flex-wrap: wrap;
  }
}
</style>
</head>
<body>
<div class="app-container">
  <div class="header">
    <h1>PoloGPT</h1>
    <div class="menu">
      <select id="language-select">
        <option value="es" selected>ES</option>
        <option value="en">EN</option>
      </select>
      <select id="theme-switch">
        <option value="dark" selected>Oscuro</option>
        <option value="light">Claro</option>
      </select>
    </div>
  </div>
  
  <div id="chat-container" class="chat-container"></div>
  
  <form class="input-area" id="chat-form">
    <div class="input-container">
      <textarea id="user-input" placeholder="Escribe tu mensaje aquí..." rows="1"></textarea>
      <button id="send-button" type="submit">Enviar</button>
    </div>
  </form>
</div>

<script>
const chatContainer = document.getElementById('chat-container');
const userInput = document.getElementById('user-input');
const chatForm = document.getElementById('chat-form');
const languageSelect = document.getElementById('language-select');
const themeSwitch = document.getElementById('theme-switch');
const sendButton = document.getElementById('send-button');

let conversationLog = [];
let defaultSystemPrompt = "Eres PoloGPT, un asistente virtual profesional y eficiente. Proporciona respuestas claras y concisas, manteniendo un tono formal y respetuoso. Adapta tu estilo para ser informativo y útil. Habla siempre en español.";
let currentSystemPrompt = defaultSystemPrompt;
let currentLanguage = 'es';
let isGenerating = false;
let controller = null;

function addMessage(role, content) {
  const messageElement = document.createElement('div');
  messageElement.classList.add('message', role);
  chatContainer.appendChild(messageElement);
  chatContainer.scrollTop = chatContainer.scrollHeight;
  return messageElement;
}

async function typeText(element, text) {
  const cleanedText = text.replace(/\s+/g, ' ');
  for (let i = 0; i < cleanedText.length; i++) {
    element.textContent += cleanedText[i];
    await new Promise(resolve => setTimeout(resolve, 10));
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }
}

function addCopyButton(messageElement, text) {
  const copyButton = document.createElement('button');
  copyButton.textContent = currentLanguage === 'es' ? 'Copiar' : 'Copy';
  copyButton.classList.add('copy-button');
  copyButton.addEventListener('click', () => {
    navigator.clipboard.writeText(text).then(() => {
      copyButton.textContent = currentLanguage === 'es' ? '¡Copiado!' : 'Copied!';
      setTimeout(() => {
        copyButton.textContent = currentLanguage === 'es' ? 'Copiar' : 'Copy';
      }, 2000);
    });
  });
  messageElement.appendChild(copyButton);
}

function addCodeBlock(messageElement, code) {
  const codeBlock = document.createElement('pre');
  codeBlock.classList.add('code-block');
  codeBlock.textContent = code;
  
  const codeCopyButton = document.createElement('button');
  codeCopyButton.textContent = currentLanguage === 'es' ? 'Copiar código' : 'Copy code';
  codeCopyButton.classList.add('code-copy-button');
  codeCopyButton.addEventListener('click', () => {
    navigator.clipboard.writeText(code).then(() => {
      codeCopyButton.textContent = currentLanguage === 'es' ? '¡Código copiado!' : 'Code copied!';
      setTimeout(() => {
        codeCopyButton.textContent = currentLanguage === 'es' ? 'Copiar código' : 'Copy code';
      }, 2000);
    });
  });
  
  messageElement.insertBefore(codeBlock, messageElement.firstChild);
  messageElement.insertBefore(codeCopyButton, codeBlock.nextSibling);
}

async function getAIResponse(userMessage) {
  const typingMessage = addMessage('ai', '');
  isGenerating = true;
  sendButton.textContent = currentLanguage === 'es' ? 'Detener' : 'Stop';
  
  try {
    controller = new AbortController();
    const signal = controller.signal;
    
    const response = await fetch('/api/chat', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        messages: conversationLog,
      }),
      signal: signal
    });
    
    if (!response.ok) {
      throw new Error('La respuesta de la red no fue correcta');
    }
    
    const reader = response.body.getReader();
    let partialResponse = '';
    
    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      
      const newText = new TextDecoder().decode(value);
      await typeText(typingMessage, newText);
      partialResponse += newText;
    }
    
    if (partialResponse === '') {
      let lastUserMessage = conversationLog[conversationLog.length - 1].content;
      let repromptMessage = `${currentSystemPrompt} El último mensaje fue: "${lastUserMessage}". Por favor, proporciona una respuesta profesional y concisa.`;
      
      conversationLog.push({ role: 'system', content: repromptMessage });
      
      chatContainer.removeChild(typingMessage);
      return getAIResponse(userMessage);
    }
    
    conversationLog.push({ role: 'assistant', content: partialResponse });
    addCopyButton(typingMessage, partialResponse);
    
    // Detectar y agregar bloques de código
    const codeRegex = /```[\s\S]*?```/g;
    const codeMatches = partialResponse.match(codeRegex);
    if (codeMatches) {
      codeMatches.forEach(codeMatch => {
        const code = codeMatch.replace(/```/g, '').trim();
        addCodeBlock(typingMessage, code);
      });
    }
    
  } catch (error) {
    if (error.name === 'AbortError') {
      console.log('Fetch aborted');
    } else {
      console.error('Error:', error);
      chatContainer.removeChild(typingMessage);
      const errorMessage = addMessage('system', '');
      await typeText(errorMessage, currentLanguage === 'es' ? 'Lo siento, ha ocurrido un error. Por favor, inténtelo de nuevo.' : 'Sorry, an error occurred. Please try again.');
    }
  } finally {
    isGenerating = false;
    sendButton.textContent = currentLanguage === 'es' ? 'Enviar' : 'Send';
    controller = null;
  }
}

chatForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  if (isGenerating) {
    if (controller) {
      controller.abort();
    }
    return;
  }
  const userMessage = userInput.value.trim();
  if (userMessage) {
    const userMessageElement = addMessage('user', '');
    await typeText(userMessageElement, userMessage);
    conversationLog.push({ role: 'user', content: userMessage });
    await getAIResponse(userMessage);
    userInput.value = '';
  }
});

languageSelect.addEventListener('change', async (e) => {
  const language = e.target.value;
  currentLanguage = language;
  if (language === 'es') {
    currentSystemPrompt = defaultSystemPrompt;
    updateLanguage('es');
  } else if (language === 'en') {
    currentSystemPrompt = "You are PoloGPT, a professional and efficient virtual assistant. Provide clear and concise answers, maintaining a formal and respectful tone. Adapt your style to be informative and helpful.";
    updateLanguage('en');
  }
  const systemMessage = addMessage('system', '');
  await typeText(systemMessage, language === 'es' ? 'Idioma cambiado a Español.' : 'Language changed to English.');
});

function updateLanguage(lang) {
  const translations = {
    'es': {
      'title': 'PoloGPT',
      'inputPlaceholder': 'Escribe tu mensaje aquí...',
      'sendButton': 'Enviar',
      'stopButton': 'Detener',
      'darkTheme': 'Oscuro',
      'lightTheme': 'Claro',
      'copyButton': 'Copiar',
      'copiedMessage': '¡Copiado!',
      'copyCodeButton': 'Copiar código',
      'copiedCodeMessage': '¡Código copiado!'
    },
    'en': {
      'title': 'PoloGPT',
      'inputPlaceholder': 'Type your message here...',
      'sendButton': 'Send',
      'stopButton': 'Stop',
      'darkTheme': 'Dark',
      'lightTheme': 'Light',
      'copyButton': 'Copy',
      'copiedMessage': 'Copied!',
      'copyCodeButton': 'Copy code',
      'copiedCodeMessage': 'Code copied!'
    }
  };

  document.title = translations[lang].title;
  document.querySelector('h1').textContent = translations[lang].title;
  userInput.placeholder = translations[lang].inputPlaceholder;
  sendButton.textContent = isGenerating ? translations[lang].stopButton : translations[lang].sendButton;
  themeSwitch.options[0].text = translations[lang].darkTheme;
  themeSwitch.options[1].text = translations[lang].lightTheme;
  
  // Update copy buttons
  document.querySelectorAll('.copy-button').forEach(button => {
    button.textContent = translations[lang].copyButton;
  });

  // Update code copy buttons
  document.querySelectorAll('.code-copy-button').forEach(button => {
    button.textContent = translations[lang].copyCodeButton;
  });
}

themeSwitch.addEventListener('change', (e) => {
  if (e.target.value === 'light') {
    document.body.classList.add('light-theme');
  } else {
    document.body.classList.remove('light-theme');
  }
});

(async function init() {
  const welcomeMessage = addMessage('system', '');
  await typeText(welcomeMessage, 'Bienvenido a PoloGPT. ¿En qué puedo ayudarte hoy?');
  conversationLog.push({ role: 'system', content: currentSystemPrompt });
})();
</script>
</body></html>
